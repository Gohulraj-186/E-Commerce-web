<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Cart</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
<header class="site-header">
  <div class="container">
    <h1 class="logo"><a href="index.html">Capstone eShop</a></h1>
    <nav class="site-nav">
      <a href="index.html">Home</a>
      <a href="cart.html" class="active">Cart (<span id="cartCount">0</span>)</a>
    </nav>
  </div>
</header>

<main class="container">
  <h2>Your Shopping Cart</h2>
  <div id="cartItems" style="display:grid;gap:1rem;margin-top:1rem;"></div>
  <div id="cartTotal" style="margin-top: 1rem;font-weight: bold;"></div>

  <button id="proceedBuy" style="margin-top: 1rem; background: green; color: white; padding: 10px 15px; font-size: 1rem; border: none; border-radius: 6px; cursor: pointer;">
    Proceed to Buy
  </button>

  <button id="clearCart" style="margin-top: 1rem;">Clear Cart</button>
</main>

<footer class="site-footer">
  <div class="container">
    <p>&copy; <span id="year"></span> Capstone eShop</p>
  </div>
</footer>

<script>
const cartKey = 'eshop_cart_v1';
let cart = JSON.parse(localStorage.getItem(cartKey) || '[]');

function updateCartCount() {
  document.getElementById('cartCount').textContent = cart.length;
}

function renderCart() {
  const container = document.getElementById('cartItems');
  const totalEl = document.getElementById('cartTotal');

  if (cart.length === 0) {
    container.innerHTML = "<p>Your cart is empty.</p>";
    totalEl.textContent = "";
    document.getElementById('proceedBuy').style.display = "none";
    return;
  }

  document.getElementById('proceedBuy').style.display = "inline-block";

  let total = 0;
  container.innerHTML = cart.map(item => {
    total += item.price * item.qty;
    return `
      <div class="cart-item">
        <img src="${item.img}" alt="${item.name}">
        <div style="flex:1">
          <h3>${item.name}</h3>
          <p>Price: ₹${item.price}</p>
          <label>Quantity:
            <input type="number" min="1" value="${item.qty}" onchange="changeQuantity(${item.id}, this.value)" style="width:60px;">
          </label>
        </div>
        <div style="display:flex; flex-direction:column; gap:5px;">
          <button onclick="removeFromCart(${item.id})">Remove</button>
          <button onclick="buyNow(${item.id})" style="background:green;">Buy Now</button>
        </div>
      </div>
    `;
  }).join('');

  totalEl.textContent = "Total: ₹" + total;
}

function changeQuantity(id, newQty) {
  newQty = parseInt(newQty);
  if (isNaN(newQty) || newQty < 1) return;
  const product = cart.find(item => item.id === id);
  if (product) {
    product.qty = newQty;
    localStorage.setItem(cartKey, JSON.stringify(cart));
    renderCart();
  }
}

function removeFromCart(id) {
  cart = cart.filter(item => item.id !== id);
  localStorage.setItem(cartKey, JSON.stringify(cart));
  updateCartCount();
  renderCart();
}

function buyNow(id) {
  const product = cart.find(item => item.id === id);
  if (!product) return;
  alert(`Proceeding to buy: ${product.name} (x${product.qty}) for ₹${product.price * product.qty}`);
}

function proceedBuyAll() {
  let total = cart.reduce((sum, item) => sum + (item.price * item.qty), 0);
  alert(`Proceeding to buy all items. Total amount: ₹${total}`);
}

document.getElementById('proceedBuy').addEventListener('click', proceedBuyAll);

document.getElementById('clearCart').addEventListener('click', () => {
  cart = [];
  localStorage.setItem(cartKey, JSON.stringify(cart));
  updateCartCount();
  renderCart();
});

updateCartCount();
renderCart();
</script>
</body>
</html>
